<!DOCTYPE html>
<html>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<style>
		.w3-myfont {
		  font-family: "Comic Sans MS", cursive, sans-serif;
		}
		body, h1, h2, h3, h4, h5, h6  {
			font-family: "Monotype Corsiva", "Copperplate", Monaco, monospace;
	
		}
		.title {
			background-color:#ecd9a8;
			color:black;
			font-weight:bold;
			border-color:#e7c46d;			
			border-top-style: solid;
			border-right-style: none;
			border-bottom-style: solid;
			border-left-style: none;
		}
		#r0,#r1,#r2,#r3,#r4 {
			font-size:50px;
		}
		#p0,#p1,#p2,#p3,#p4,#p5,#p6,#p7 {
			font-size:30px;
			color:green;
		}
		#a0,#a1,#a2,#a3,#a4,#a5,#a6,#b0,#b1,#b2,#b3{
			font-size:30px;
		}
		#m0,#m1,#m2,#m3{
			font-size:30px;
			color:red;
		}
	</style>
	<body id="body" class="w3-indigo">
	<div class="w3-container w3-padding-32 w3-xlarge" id="tabHolder">
		<p>How many players are there?</p>
		<input class="w3-input" id="playerCount" style="width: 35px"><br>
		<span onclick="createTabs()" class="w3-button w3-light-green">Go</span>
	</div>	
	<div id="main"class="w3-center w3-padding-32 w3-hide">		
		<h2 id="teamName" class="w3-center title">Team 1</h2>
		<h2 class="w3-xxlarge title">Resources</h2><br><br>
	
		<div class="w3-bar">
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="resource(0)" class="w3-btn"><img src="gold.png" style="width:75px"></button>
				<div  id="r0">0</div>
			</div>		
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="resource(1)" class="w3-btn"><img src="iron.png" style="width:75px"></button>
				<div  id="r1">0</div>
			</div>		
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="resource(2)" class="w3-btn"><img src="stone.png" style="width:75px"></button>
				<div  id="r2">0</div>
			</div>
		</div>		
		<div class="w3-bar">
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="resource(3)" class="w3-btn"><img src="wood.png" style="width:75px"></button>
				<div id="r3">0</div>
			</div>		
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="resource(4)" class="w3-btn"><img src="bread.png" style="width:75px"></button>		
				<div id="r4">0</div>
			</div>
			
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
			<button onclick="resource(5)" class="w3-btn w3-bar-item"><img src="undo.png" style="width:75px"></button>
			</div>
		</div>
		
		<h2 class="w3-xxlarge title">Combat</h2><br><br>
		<div class="w3-bar">
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="battle(4)" class="w3-btn w3-bar-item"><img src="undo.png" style="width:75px"></button>
				<button onclick="battle(1)" class="w3-btn w3-bar-item"><img src="knight.png" style="width:75px"></button>		
				<span id="b1">0</span> &nbsp; &nbsp; <span  id="m1">0</span>		
				<button onclick="battle(0)" class="w3-btn w3-bar-item"><img src="mercenary.png" style="width:75px"></button>		
				<span id="p7">0</span> &nbsp; &nbsp; <span  id="b0">0</span> &nbsp; &nbsp; <span  id="m0">0</span>
			</div>
			
			<div class="w3-bar-item">&nbsp;</div>
			
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="battle(5)" class="w3-btn w3-bar-item"><img src="cancel.png" style="width:75px"></button>
				<button onclick="battle(2)" class="w3-btn w3-bar-item"><img src="knight.png" style="width:75px"></button>		
				<span id="b2">0</span> &nbsp; &nbsp; <span  id="m2">0</span>		
				<button onclick="battle(3)" class="w3-btn w3-bar-item"><img src="farmer.png" style="width:75px"></button>		
				<span  id="b3">0</span> &nbsp; &nbsp; <span  id="m3">0</span>
			</div>
		</div>
		<br><button onclick="fight()" class="w3-btn"><img src="fight.png" style="width:200px"></button><br><br><br>
		
		<h2 class="w3-xxlarge title">Purchases</h2><br><br>
		<div class="w3-bar">
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="purchase(0)" class="w3-btn"><img src="plot.png" style="width:75px"></button>
				<br><span  id="p0">0</span> &nbsp; &nbsp; <span  id="a0">0</span>
			</div>		
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="purchase(1)" class="w3-btn"><img src="farmer.png" style="width:75px"></button>
				<br><span  id="p1">0</span> &nbsp; &nbsp; <span  id="a1">0</span>
			</div>		
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="purchase(2)" class="w3-btn"><img src="woodsman.png" style="width:75px"></button>
				<br><span  id="p2">0</span> &nbsp; &nbsp; <span  id="a2">0</span>
			</div>
		</div>		
		<div class="w3-bar">
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="purchase(3)" class="w3-btn"><img src="miner.png" style="width:75px"></button>
			<br><span  id="p3">0</span> &nbsp; &nbsp; <span  id="a3">0</span>
			</div>		
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="purchase(4)" class="w3-btn"><img src="knight.png" style="width:75px"></button>		
			<br><span  id="p4">0</span> &nbsp; &nbsp; <span  id="a4">0</span>
			</div>
			
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="purchase(5)" class="w3-btn"><img src="fort.png" style="width:75px"></button>		
			<br><span  id="p5">0</span> &nbsp; &nbsp; <span  id="a5">0</span>
			</div>
		</div>
		<div class="w3-bar">
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="purchase(6)" class="w3-btn"><img src="swap.png" style="width:75px"></button>
			<br><span  id="p6">0</span> &nbsp; &nbsp; <span  id="a6">0</span>
			</div>		
			<div class="w3-bar-block w3-bar-item" style="padding:0px">
				<button onclick="purchase(7)" class="w3-btn"><img src="undo.png" style="width:75px"></button>	
			</div>
			
		</div>
		
		<br><br><button onclick="nextTeam(),document.location='#teamName'" class="w3-btn"><img src="nextTurn.png" style="width:200px"></button>
	</div>

	</body>
	<script>
	let colors = ["w3-purple", "w3-light-green", "w3-red", "w3-orange", "w3-blue-grey", "w3-cyan"];
	var teams = [];
	var teamTurn = 0;
	var playerNum;
	var memory = [];
	var pMemory = [];	
	var bMemory = [];
	var pAmount = [0,0,0,0,0,0,0,0];
	var attack;
	var defense; 
	//Mercenary, Attack Knight, Defense Knight, Peasant
	var battleNum = [0,0,0,0];
	var oldNum = [0,0,0,0];
	//gold iron stone wood bread
	var cost = [
	//plot
	[5,0,0,0,0],
	//farmer
	[0,1,1,2,2],
	//woodsman
	[0,2,1,1,2],
	//miner
	[0,1,0,3,2],
	//knight
	[0,3,0,1,2],
	//fortification
	[0,0,3,0,0],
	//exchange
	[2,0,0,0,0],
	//mercenary
	[2,0,0,0,0]	
	];
	
	function fight(){
		bMemory = []
		for (let i = 0; i < 4; i ++){
			oldNum[i] = battleNum[i]
		}
		console.log(oldNum,battleNum)
		attack = 0
		defense = 0
		for(let i = 0; i < 4; i++) {
			console.log(battleNum[i])
			
			for (let j = 0; j < battleNum[i]; j++){
				console.log(j)
				let x = Math.floor(Math.random() * 6) + 1;
				if (x == 1){
					if (i < 2) {
						attack ++
					}
					else {
						defense ++
					}
				}
				else if (x == 2 && (i > 0 || i < 3)){
					if (i == 1) {
						attack ++
					}
					else {
						defense ++
					}
				}
			}
		}
		battleNum[0] -= defense, battleNum[3] -= attack;
		if (battleNum[0] < 0){
			battleNum[1] += battleNum[0]
		}
		if (battleNum[3] < 0){
			battleNum[2] += battleNum[3]
		}
		for(let i = 0; i < 4; i++) {
			if (battleNum[i] < 0){
				battleNum[i] = 0
			}
		}		
		console.log(oldNum,battleNum)
		update()
	}
	function avail(index){
		let amount = []
			for (let j in teams[teamTurn].resource){
				if (cost[index][j] > 0){
					amount.push(Math.floor(teams[teamTurn].resource[j] / cost[index][j]))
				}
			}
		return amount.sort(function(a, b){return a-b})[0]
	}
	function update(){
		for (let i = 0; i < 5; i ++){
			document.getElementById("r"+i).innerHTML = teams[teamTurn].resource[i]
		}
		for (let i = 0; i < 7; i ++){	
			document.getElementById("a"+i).innerHTML = pAmount[i]
		}
		for (let i = 0; i < 8; i ++){
			document.getElementById("p"+i).innerHTML = avail(i)	
		}
		for (let i = 0; i < 4; i ++){
			document.getElementById("b"+i).innerHTML = battleNum[i]			
			document.getElementById("m"+i).innerHTML = oldNum[i] - battleNum[i]
		}
	}
	function createPlayers() {
		return{
			resource: [0, 0, 0, 0, 0]
		};
	}
	function purchase(act) {
		if (act == 7) {
			if (pMemory.length > 0){
				for (let i = 0; i < 5; i ++){
					teams[teamTurn].resource[i] += cost[pMemory[pMemory.length -1]][i]
				}
				pAmount[pMemory[pMemory.length -1]] --;
				pMemory.pop();
			}
		}
		else {
			if (avail(act) > 0) {
				for (let i = 0; i < 5; i ++){
					teams[teamTurn].resource[i] -= cost[act][i]
				}
				pMemory.push(act);
				pAmount[act] ++;
			}
		}
		update()
	}
	function resource(act) {
		if (act == 5) {
			if(memory.length > 0){
				teams[teamTurn].resource[memory[memory.length - 1]] --;
				memory.pop();
			}
		}
		else {
			teams[teamTurn].resource[act] ++
			memory.push(act)
		}
		update()
	}
	function battle(act) {
		if (act == 4) {
			if(bMemory.length > 0){
				battleNum[bMemory[bMemory.length -1 ]] --;
				if(bMemory[bMemory.length - 1] == 0){
					teams[teamTurn].resource[0] += 2
				}
				bMemory.pop();
			}
		}
		else if (act == 5){
			if(bMemory.length > 0){
				teams[teamTurn].resource[0] += battleNum[0] * 2
			}
			battleNum = [0,0,0,0]
			bMemory = []
		}
		else {
			if (act == 0){
				if (avail(7) > 0) {
					battleNum[act] ++
					teams[teamTurn].resource[0] -= 2
				}
				
			}
			else {				
				battleNum[act] ++
			}
			bMemory.push(act)
		}
		for (let i = 0; i < 4; i ++){
			oldNum[i] = battleNum[i]
		}
		update()
	}
	function createTabs() {
		let x = document.getElementById('playerCount').value;
		playerNum = x;
		if (x > 1 && x <= 6) {
			document.getElementById('tabHolder').classList = "w3-hide"
			document.getElementById('main').classList.remove("w3-hide")
			for(i = 0; i <= x; i ++) {
				teams[i] = createPlayers();
			};
		};
	};
	function nextTeam()	{
		teamTurn ++
		if (teamTurn >= playerNum) {
			teamTurn = 0;
		}
		document.getElementById("teamName").innerHTML = "Team " + (teamTurn + 1)
		document.getElementById("body").classList = colors[teamTurn]
		memory=[]
		pMemory=[]
		pAmount = [0,0,0,0,0,0,0,0]
		battleNum = [0,0,0,0]
		oldNum = [0,0,0,0]
		update()
	}
	</script>
</html>
